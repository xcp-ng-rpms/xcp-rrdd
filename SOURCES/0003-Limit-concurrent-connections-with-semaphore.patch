From 8ddbf423419978ea88649e07a9c59ffa20f5ba24 Mon Sep 17 00:00:00 2001
From: Rob Hoes <rob.hoes@citrix.com>
Date: Fri, 19 Aug 2022 15:33:05 +0000
Subject: [PATCH 3/3] Limit concurrent connections with semaphore

Signed-off-by: Rob Hoes <rob.hoes@citrix.com>
(cherry picked from commit 31d35ed6fe5974f1c2de24581bc076f5b5c6ac7e)
---
 rrdd/xcp_rrdd.ml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/rrdd/xcp_rrdd.ml b/rrdd/xcp_rrdd.ml
index 722da3311..fc616da9a 100644
--- a/rrdd/xcp_rrdd.ml
+++ b/rrdd/xcp_rrdd.ml
@@ -93,7 +93,7 @@ let start (xmlrpc_path, http_fwd_path) process =
   Xapi_stdext_unix.Unixext.mkdir_safe (Filename.dirname xmlrpc_path) 0o700 ;
   Xapi_stdext_unix.Unixext.unlink_safe xmlrpc_path ;
   let xmlrpc_socket = Http_svr.bind (Unix.ADDR_UNIX xmlrpc_path) "unix_rpc" in
-  Http_svr.start server xmlrpc_socket ;
+  Http_svr.start ~conn_limit:1024 server xmlrpc_socket ;
   Xapi_stdext_unix.Unixext.unlink_safe http_fwd_path ;
   let http_fwd_socket = Unix.socket Unix.PF_UNIX Unix.SOCK_STREAM 0 in
   Unix.bind http_fwd_socket (Unix.ADDR_UNIX http_fwd_path) ;
-- 
2.31.1

